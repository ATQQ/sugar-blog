---
sidebar:
 title: ä¸­ç­‰-æ•°ç»„å»é‡
 step: 14
title: ç¬”è¯•é¢˜-æ•°ç»„å»é‡
date: 2021-03-07
tags:
 - æ‰‹æ’•ä»£ç 
 - javascript
categories:
 - æ‰‹æ’•ä»£ç 
---
# ç¬”è¯•é¢˜-æ•°ç»„å»é‡

>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§„çš„é¢è¯•æ‰‹å†™é¢˜,èƒ½å¤Ÿè€ƒæŸ¥é¢è¯•è€…å¯¹å„ç§æ•°æ®ç±»å‹ç‰¹æ€§äº†è§£ç¨‹åº¦

ä¸ç½‘ä¸Šæ‰€å™è¿°çš„å¸¸è§„`Nç§æ–¹æ³•å®ç°å»é‡`åˆæœ‰äº›ä¸ä¸€æ ·

æœ¬æ–‡å’±ä»¬å…ˆç†æ¸…æ€è·¯,ç„¶åé¡ºç€æ€è·¯**ä½¿ç”¨æœ´ç´ çš„ä»£ç è¿›è¡Œå®ç°**,å¹¶**æ»¡è¶³ä¸€äº›ç‰¹æ®Šè¦æ±‚**

## é¢˜ç›®æè¿°
å®ç°ä¸€ä¸ª`duplicate`æ–¹æ³•,å®ç°æ•°ç»„çš„å»é‡

### ç‰¹æ®Šè¦æ±‚
1. è€ƒè™‘å€¼ç±»å‹ä¸å¼•ç”¨ç±»å‹
   1. å¼•ç”¨ç±»å‹åªè€ƒè™‘æ™®é€š`Array`ä¸`Object`
   2. å¯ä»¥ä¸è€ƒè™‘Symbolä¸BigInt
2. ä¸è€ƒè™‘function
3. `{}`ä¸`{}`,`{a:1,b:2}`ä¸`{b:2,a:1}`,`[]`ä¸`[]`ç®—ç›¸ç­‰
   1. å³åªè¦å¯¹è±¡çš„æ¯ä¸€é¡¹å€¼éƒ½ç›¸ç­‰é‚£ä¹ˆä¹Ÿç®—ç›¸ç­‰
4. **ä¸èƒ½ä½¿ç”¨set** (ç›´æ¥ä½¿ç”¨setå°±é™ä½äº†é¢˜ç›®éš¾åº¦)

```js
function duplicate(arr){
    // ...code
}
```

## é¢˜ç›®åˆ†æ
1. é¦–å…ˆéœ€è¦è€ƒè™‘çš„å€¼ç±»å‹æœ‰5ç§
   * null
   * undefined
   * string
   * boolean
   * number
2. number çš„è¯éœ€è¦ç‰¹æ®Šè€ƒè™‘`NaN`
   * `NaN !== NaN` --> `true`
3. åˆ¤æ–­æ­¥éª¤å¯ä»¥**å…ˆåˆ¤æ–­ç±»å‹æ˜¯å¦ä¸€è‡´**,å¦‚æœä¸€è‡´**å†åˆ¤æ–­å†…å®¹**
4. æŒ‰**é¢˜ç›®ç‰¹æ®Šè¦æ±‚**åˆ¤æ–­å¼•ç”¨ç±»å‹æ˜¯å¦ç›¸ç­‰çš„æ­¥éª¤
   1. æœ‰æœ‹å‹å¯èƒ½ä¼šè¯´ç›´æ¥`JSON.stringify(obj)`,è¯´æ˜æ²¡æœ‰è€ƒè™‘å‘¨å…¨,å¯¹è±¡çš„é”®é¡ºåºä¸ä¸€è‡´,å¯¼è‡´stringifyçš„ç»“æœä¸ä¸€è‡´çš„é—®é¢˜

## è§£é¢˜æ€è·¯
1. (ç¬”è€…) `åˆ¤æ–­ä¸¤ä¸ªå¼•ç”¨ç±»å‹æ˜¯å¦å€¼å®Œå…¨ä¸€è‡´` çš„æ€è·¯
   1. åˆ¤æ–­å¼•ç”¨ç±»å‹
      1. æ•°ç»„
      2. å¯¹è±¡
   2. æ•°ç»„
      1. åˆ¤æ–­æ•°ç»„é•¿åº¦æ˜¯å¦ä¸€è‡´
      2. é€é¡¹è¿›è¡Œæ¯”è¾ƒ
   3. å¯¹è±¡
      1. åˆ¤æ–­ç›®æ ‡å¯¹è±¡è‡ªèº«å±æ€§é”®çš„æ•°é‡æ˜¯å¦ä¸€è‡´,ä¸€è‡´å†åˆ¤æ–­ï¼¡æ˜¯å¦å®Œå…¨åŒ…å«ï¼¢çš„é”®
      2. é€é¡¹åˆ¤æ–­å€¼æ˜¯å¦ä¸€è‡´
6. å»é‡æ­¥éª¤æ€è·¯
   1. åŸæ•°ç»„è®°ä¸º`arr`,æ–°æ•°ç»„è®°ä¸º`res`
   2. éå†`arr`ä¸`res`çš„æ¯ä¸€é¡¹è¿›è¡Œæ¯”è¾ƒ
      1. å…ˆåˆ¤æ–­ç±»å‹æ˜¯å¦ä¸€è‡´
      2. éƒ½æ˜¯å€¼ç±»å‹,åˆ™ `===` æ¯”è¾ƒ
      3. éƒ½æ˜¯æ•°ç»„,åˆ™æ¯”è¾ƒæ•°ç»„çš„æ¯ä¸€é¡¹æ˜¯å¦ä¸€è‡´
      4. éƒ½æ˜¯å¯¹è±¡,åˆ™æ¯”è¾ƒæ˜¯å¦æ‹¥æœ‰ç›¸åŒçš„é”®ä¸”é”®çš„å€¼æ˜¯ä¸€æ ·
## åˆ†æ­¥éª¤å®ç°

### åŠŸèƒ½å‡½æ•°å®ç°
1. åˆ¤æ–­ç±»å‹æ˜¯å¦ä¸€è‡´
```js
function isSameType(a, b) {
    // ä¸¤è€…éƒ½æ˜¯å€¼ç±»å‹
    if (typeof a === typeof b && !(a instanceof Object) && !(b instanceof Object)) {
        return true
    }

    // ä¸¤è€…éƒ½æ˜¯å¯¹è±¡
    if (a instanceof Object && b instanceof Object) {
        let aOk = a instanceof Array
        let bOk = b instanceof Array
        // éƒ½æ˜¯æ•°ç»„,æˆ–è€…éƒ½ä¸æ˜¯æ•°ç»„åˆ™ok --> aOK === bOk
        return aOk === bOk
    }
    return false
}
```
2. åˆ¤æ–­æ˜¯å¦æ˜¯å€¼/å¼•ç”¨ç±»å‹

>å› ä¸ºé¢˜ç›®çš„å¼•ç”¨ç±»å‹åªåŒ…å«Arrayä¸Object,æ‰€ä»¥è¿™é‡Œç®€å•ä½¿ç”¨**instanceof**åˆ¤æ–­
```js
function isObject(a){
    return a instanceof Object
}

function isValueType(a){
    return !isObject(a)
}
```

3. åˆ¤æ–­å€¼ç±»å‹çš„ä¸¤è€…æ˜¯å¦å€¼ä¸€è‡´

```js
function isSame(a, b) {
    // ä¸ºä»€ä¹ˆä¸ç”¨isNaN
    // å› ä¸ºisNaN(undefined) ä¸ºtrue
    return (a === b) || (a !== a && b !== b)
}
```

4. åˆ¤æ–­å¼•ç”¨ç±»å‹çš„ä¸¤è€…æ˜¯å¦ä¸€è‡´
   
> ä»£ç æœªåšä¼˜åŒ–,å¯èƒ½æœ‰ç‚¹ğŸ’©ğŸ’©(å®Œå…¨æŒ‰ç…§ä¸Šè¿°æ€è·¯ç¼–å†™),æœ‰ä¼˜åŒ–ç©ºé—´
```js
function isEqual(a, b) {
    if (!isSameType(a, b)) {
        return false
    }
    // éƒ½æ˜¯æ•°ç»„
    if (Array.isArray(a)) {
        if (a.length !== b.length) {
            return false
        }

        // é€é¡¹åˆ¤æ–­
        for (let i = 0; i < a.length; i++) {
            let _a = a[i]
            let _b = b[i]
            // ç±»å‹ä¸ç­‰
            if (!isSameType(_a, _b)) {
                return false
            }

            // å€¼ç±»å‹,å€¼ä¸ç­‰
            if (isValueType(_a) && !isSame(_a, _b)) {
                return false
            }

            // å¯¹è±¡ - é€’å½’åˆ¤æ–­äº†
            if(isObject(_a)&&!isEqual(_a,_b)){
                return false
            }
        }
    }
    else {
        // éƒ½æ˜¯æ™®é€šå¯¹è±¡
        let aKeys = Reflect.ownKeys(a)
        let bKeys = Reflect.ownKeys(b)

        // é”®æ•°é‡ä¸ä¸€è‡´
        if(aKeys.length!==bKeys.length){
            return false
        }

        for (const aKey of aKeys) {
            let _a = a[aKey]
            let _b = b[aKey]
            // ç±»å‹ä¸ç­‰
            if (!isSameType(_a, _b)) {
                return false
            }

            // å€¼ç±»å‹,å€¼ä¸ç­‰
            if (isValueType(_a) && !isSame(_a, _b)) {
                return false
            }

            // å¯¹è±¡ - é€’å½’åˆ¤æ–­äº†
            if(isObject(_a)&&!isEqual(_a,_b)){
                return false
            }
        }
    }

    return true
}
```

å‡†å¤‡å·¥ä½œåˆ°æ­¤ç®—å®Œæˆäº†,ç°åœ¨å’±ä»¬**å¼€å§‹ç»„è£…é›¶ä»¶**

### å»é‡å‡½æ•°å®ç°
```js
function duplicate(arr) {
    // å­˜æ”¾æœ€ç»ˆç»“æœ
    const res = []
    // éå†å’±ä»¬çš„åŸæ•°ç»„
    for (const a of arr) {
        // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
        let isExist = res.findIndex(b => {
            // è¿™é‡Œå°±å˜æˆäº†å½“å‰é¡¹ä¸åŸæ¥çš„æ¯ä¸€é¡¹è¿›è¡Œæ¯”è¾ƒ
            if (!isSameType(a, b)) {
                return false
            }
            if (isValueType(a) && !isSame(a, b)) {
                return false
            }

            if (isObject(a) && !isEqual(a, b)) {
                return false
            }

            return true
        }) !== -1

        // ä¸å­˜åœ¨åˆ™æ”¾å…¥
        if (!isExist) {
            res.push(a)
        }
    }
    return res
}
```

## æœ€ç»ˆæµ‹è¯•

æµ‹è¯•æ•°æ®
```js
let obj1 = { age: [1, 2, { data: [1, 2, 3], name: 'a' }], name: 'xm' }
let obj2 = { name: 'xm', age: [1, 2, { name: 'a', data: [1, 2, 3] }] }
let a = [1, 2, '1', '2', 1, null, null, undefined, undefined, {}, {}, [], [], [1], [1], [1, 2], [2, 1], ['1'], ['1'], obj1, obj2, false, false, NaN,NaN, true, true]
```

ç»“æœ
```js
duplicate(a)
[
  1,
  2,
  '1',
  '2',
  null,
  undefined,
  {},
  [],
  [ 1 ],
  [ 1, 2 ],
  [ 2, 1 ],
  [ '1' ],
  { age: [ 1, 2, { data: [1, 2, 3], name: 'a' } ], name: 'xm' },
  false,
  NaN,
  true
]
```

## æ€»ç»“
1. è€ƒæŸ¥çŸ¥è¯†ç‚¹
   1. ç±»å‹åˆ¤æ–­
   2. å€¼ç±»å‹ç‰¹ç‚¹
   3. å¼•ç”¨ç±»å‹ç‰¹ç‚¹
   4. NaNçš„ç‰¹ç‚¹
2. æ•´ä¸ªä»ä»£ç é‡çœ‹ä¸‹æ¥,å°±æ˜¯**åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å€¼ç›¸ç­‰**é‚£é‡Œç¨å¾®å¤æ‚ä¸€ç‚¹
3. åšç¬”è¯•é¢˜åªè¦æŠŠ**è¾¹ç•Œæƒ…å†µè€ƒè™‘æ¸…æ¥š**,**ç†æ¸…æ€è·¯**,åœ¨ä¸è€ƒè™‘æ—¶é—´å¤æ‚åº¦çš„æ—¶å€™,ç”¨æœ´ç´ çš„ä»£ç å°±èƒ½å®Œæˆ

>ç¬”è€…èƒ½åŠ›æœ‰é™,ä»£ç å¦‚æœ‰bug,è¿˜è¡ŒæŒ‡æ­£


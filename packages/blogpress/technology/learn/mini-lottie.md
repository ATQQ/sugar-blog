---
tags: 
 - æŠ€æœ¯ç¬”è®°
 - å°ç¨‹åº
# date: 2024-04-20 23:16:00
description: è®°å½•åˆ†äº«åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ lottie æ’­æ”¾AEåŠ¨ç”»çš„æ–¹æ³•ï¼Œä»¥åŠè¸©å‘ç»éªŒã€‚
---
# å°ç¨‹åºä¸­ä½¿ç”¨ lottie åŠ¨ç”» | è¸©å‘ç»éªŒåˆ†äº«

æœ¬å‘¨è¢«æ‹‰å»æ”¯æ´ç´§æ€¥éœ€æ±‚ï¼ˆèµ¶åœ¨äº”ä¸€èŠ‚å‡æ—¥å‰ä¸Šçº¿çš„ï¼ŒåŒä¼‘éœ€è¦åŠ ç­ğŸ˜±ï¼‰ï¼Œå‚ä¸åˆ°é¡¹ç›®ä¸­æ‰çŸ¥é“ï¼Œå¼€å‘çš„é¡¹ç›®æ˜¯å¾®ä¿¡å°ç¨‹åºæŠ€æœ¯æ ˆçš„ã€‚ç”±äºæ˜¯ä¸´æ—¶æ”¯æ´ï¼Œç¬”è€…ä¹Ÿå¾ˆä¹…æ²¡å¼€å‘è¿‡å¾®ä¿¡å°ç¨‹åºäº†ï¼Œæ‰€ä»¥æŒ‘é€‰äº†ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸šåŠ¡å±æ€§ç›¸å¯¹è½»è–„çš„æ¨¡å—å‚ä¸ã€‚

å…¶ä¸­æœ‰ä¸ªè¥é”€æ´»åŠ¨ï¼ˆé¢†çº¢åŒ…ğŸ§§ğŸ˜ï¼‰çš„å¼¹çª—åŠ¨ç”»å°±è¦ç”¨åˆ° lottie åŠ¨ç”»ã€‚

æœ¬æ–‡å°±åˆ†äº«ä¸€ä¸‹åœ¨å°ç¨‹åºä¸­ä½¿ç”¨ lottie è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä¸è§£å†³åŠæ³•ã€‚

## å…³äº lottie

[lottie](https://airbnb.io/lottie/#/README) æ˜¯ Airbnb å¼€æºçš„ä¸€ä¸ªåŠ¨ç”»åº“ï¼Œç”¨äºåœ¨ç«¯ä¸Šç›´æ¥æ’­æ”¾ AE ( Adobe After Effects)åŠ¨ç”»ã€‚

é€šè¿‡ [bodymovin](https://github.com/airbnb/lottie-web/tree/master/build/extension) AE æ’ä»¶å°†åŠ¨ç”»æ–‡ä»¶å¯¼å‡ºä¸º json æ–‡ä»¶ï¼Œlottie SDK é€šè¿‡å¯ä»¥é€šè¿‡ JSON æ–‡ä»¶ç›´æ¥æ’­æ”¾åŠ¨ç”»ã€‚

å…·ä½“ demos æ•ˆæœå¯ä»¥ä¸Š [LottieFiles](https://lottiefiles.com/) ç½‘ç«™æŸ¥çœ‹ã€‚

## å¦‚ä½•ä½¿ç”¨ AE å¯¼å‡ºåŠ¨ç”»éœ€è¦çš„JSONæ–‡ä»¶
å®Œæˆ AE è½¯ä»¶å®‰è£…åï¼Œå‚ç…§ [Lottie Web GitHub å®˜æ–¹æ–‡æ¡£](https://github.com/airbnb/lottie-web/tree/master?tab=readme-ov-file#plugin-installation) å®Œæˆ `bodymovin` æ’ä»¶çš„å®‰è£…ã€‚

æ‰“å¼€åŠ¨ç”»æ–‡ä»¶åï¼Œåªéœ€ç®€å•å‡ æ­¥æ“ä½œ

â‘  window ä¸­é€‰æ‹© Bodymovie

![](https://img.cdn.sugarat.top/mdImg/sugar/e887b3af9200905af6a3484300de1d3b)

â‘¡ é€‰æ‹©éœ€è¦å¯¼å‡ºçš„åŠ¨ç”»èµ„æº

![](https://img.cdn.sugarat.top/mdImg/sugar/ddb3ce4d7c88df65ee50cca915817fa7)

â‘¢ å¯¼å‡ºé…ç½®ï¼ˆå°ç¨‹åºç›¸å…³ï¼‰

ç‚¹å‡»å¯¹åº”åŠ¨ç”»çš„è®¾ç½®

![](https://cdn.upyun.sugarat.top/mdImg/sugar/e8a6dfc08dd521ccf65cf2c003c00aac)

å‹¾é€‰ `Glyphs` å°†ç”¨åˆ°çš„æ–‡å­—+å­—ä½“å¯¼å‡ºä¸ºå›¾å½¢ã€‚

å°ç¨‹åºé‡Œæ¸²æŸ“ä¸æ”¯æŒåŠ è½½å¤–éƒ¨å­—ä½“ã€‚

![](https://cdn.upyun.sugarat.top/mdImg/sugar/fab7f7d9ca8aafd9f7935afdb0d91b74)

*è¿™ä¸ªå°±ä¼šæœ‰ tree shakeçš„æ•ˆæœï¼Œå¦‚æœåŠ¨ç”»é‡Œæ²¡æœ‰ç”¨åˆ°çš„æ–‡å­—ï¼ŒåšåŠ¨æ€æ›¿æ¢çš„æ—¶å€™å°±ä¼šä¸æ˜¾ç¤ºï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»åˆ°*ã€‚

å‹¾é€‰ `Convert expressions to keyframes` å°†è¡¨è¾¾å¼è½¬ä¸ºå…³é”®å¸§ï¼Œå› ä¸ºå°ç¨‹åºé‡Œä¸æ”¯æŒä½¿ç”¨ `eval` ç­‰åŠ¨æ€æ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›ã€‚

![](https://cdn.upyun.sugarat.top/mdImg/sugar/ca9d49f12f786b36cb1699958a56421e)

ä¿®æ”¹å®Œæˆåç‚¹å‡»`Save`ä¿å­˜é…ç½®ã€‚

â‘£ æ¸²æŸ“å¯¼å‡º JSON æ–‡ä»¶

æœ€åç‚¹å‡» Render æŒ‰é’®ï¼Œå¯¼å‡º JSON æ–‡ä»¶ã€‚

![](https://cdn.upyun.sugarat.top/mdImg/sugar/e4e147a1d4a9a79b8d19f09bfc402bc0)

å¯¼å‡ºæ–‡ä»¶å¦‚ä¸‹ï¼Œdata.json æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ JSON æ–‡ä»¶ï¼Œimages é‡Œå­˜å‚¨çš„å°±æ˜¯æ’­æ”¾è¦ç”¨åˆ°çš„å›¾ç‰‡æ–‡ä»¶ã€‚

![](https://cdn.upyun.sugarat.top/mdImg/sugar/58abc6bc9d72ed6d4ff078b58ab2dbaf)

## å°ç¨‹åºä¸­ä½¿ç”¨

å¯ä»¥ä½¿ç”¨å°ç¨‹åºå®˜æ–¹å°è£…çš„ [lottie-miniprogram](https://github.com/wechat-miniprogram/lottie-miniprogram) åº“ã€‚

>å¿«é€ŸéªŒè¯çš„è¯å¯ä»¥æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·ï¼Œåœ¨ç‚¹å‡»ğŸ‘‰ğŸ» [demoä»£ç ç‰‡æ®µ](https://developers.weixin.qq.com/s/2TYvm9mJ75bF) è¿›è¡Œåˆ›å»ºã€‚

â‘  å®‰è£…ä¾èµ–

```sh
npm install --save lottie-miniprogram
```
â‘¡ ä½¿ç”¨

**tipï¼šå¼€å‘è€…å·¥å…·ä¸­éªŒè¯çš„è¯ï¼Œæ¸²æŸ“æ¨¡å¼éœ€è¦é€‰æ‹© webview ï¼Œ[Skyline](https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/skyline/introduction.html) ç›®å‰è¿˜ä¸æ”¯æŒè°ƒè¯• canvas**

index.wxml
```html
<canvas id="lottie-canvas" type="2d"></canvas>
```

index.js
```js
import lottie from 'lottie-miniprogram'

Page({
  onReady() {
    this.createSelectorQuery().select('#lottie-canvas').node((res) => {
      // å–å¾— canvas èŠ‚ç‚¹
      const canvas = res[0].node

      // è®¾ç½® cavnas ç”»å¸ƒå°ºå¯¸
      canvas.width = 600
      canvas.height = 600

      lottie.setup(canvas)

      const context = canvas.getContext('2d')
      const lottieInstance = lottie.loadAnimation({
        loop: true, // å¾ªç¯æ’­æ”¾
        autoplay: true, // è‡ªåŠ¨æ’­æ”¾
        // æœ¬åœ°ä½¿ç”¨ http-server å¯åŠ¨æœåŠ¡åï¼ŒæŒ‡å®šæœ¬åœ°èµ„æºåœ°å€
        path: 'http://127.0.0.1:8080/lottie-demo-sources/data.json', // é€šè¿‡http åˆ¶å®šjsonèµ„æºè·¯å¾„

        // ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼Œç›´æ¥ä¼ å…¥ lottie jsonå†…å®¹
        // (éœ€è¦åŠ¨æ€æ›¿æ¢æ–‡æ¡ˆå°±éœ€è¦ç”¨åˆ°è¿™ç§æ–¹å¼)
        // animationData: {/* lottie json æ ¼å¼å†…å®¹ */},
        // é™æ€èµ„æºç›®å½•ï¼Œé€šå¸¸ä¸ animationData é…åˆä½¿ç”¨
        // assetsPath: 'http://127.0.0.1:8080/lottie-demo-sources/images/',

        rendererSettings: {
          context,
        },
      })
    }).exec()
  }
})
```

æˆ‘è¿™ä¸ª demo çš„æ•ˆæœï¼ˆç½‘ä¸Šæ‰¾çš„åŠ¨ç”»ç´ æï¼‰å¦‚ä¸‹ã€‚

![](https://img.cdn.sugarat.top/mdImg/sugar/fe89db8f5a79940b2c2167062f1b321f)

## é—®é¢˜&è§£å†³
ä¸‹é¢ä»‹ç»åœ¨å®é™…ä¸šåŠ¡æ¥å…¥ä½¿ç”¨ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³åŠæ³•ã€‚

### expression è¡¨è¾¾å¼
æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼Œè¿™æ˜¯é‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ˆä¹Ÿæ˜¯ä¸Šé¢å¯¼å‡ºé…ç½®ä¸­æœ‰ç‰¹åˆ«è¯´æ˜çš„ï¼‰ã€‚

![](https://img.cdn.sugarat.top/mdImg/sugar/63b1e8a0370b0ffdd017de7ceb918465)

ç»†çœ‹äº†ä¸€ä¸‹æ–‡æ¡£ï¼Œæœ‰ç‰¹åˆ«è¯´æ˜ï¼Œexpression è¡¨è¾¾å¼ç‰¹æ€§æ˜¯ä¸æ”¯æŒçš„ï¼Œå› æ­¤éœ€è¦å†å¯¼å‡º JSON æ–‡ä»¶æ—¶ç¦ç”¨ç›¸å…³ç‰¹æ€§ã€‚

![](https://img.cdn.sugarat.top/mdImg/sugar/c8f32eb3368a511c84cf1e7803687d5c)

è§£å†³åŠæ³•ï¼šå¯¼å‡ºJSONæ–‡ä»¶æ—¶ï¼Œç¦ç”¨æ‰è¡¨è¾¾å¼ç‰¹æ€§å³å¯ã€‚

![](https://img.cdn.sugarat.top/mdImg/sugar/60104c2927d61dcb75be50fbd363f45d)

å½“ç„¶ç¦ç”¨åï¼ŒJSON æ–‡ä»¶å¤§å°ä¼šæœ‰æ‰€å¢åŠ ã€‚

æ¯”å¦‚æˆ‘è¿™ä¸ª demo ä» 40kb å¢åŠ åˆ°äº† 240kbï¼ˆå½“ç„¶åŠ¨ç”»ä¸ä¸€æ ·ï¼Œå¢é•¿çš„å¤§å°ä¼šæœ‰æ‰€ä¸åŒã€‚æœ‰äº›å‰åå¯èƒ½åªæœ‰1-2kbçš„å˜åŒ–ï¼‰ã€‚

### æ¨¡ç³Š

ç”±äºéœ€è¦å…¨å±å±•ç¤ºï¼ŒåŠ¨ç”»æ–‡ä»¶çš„å°ºå¯¸ä¸ç¡®å®šï¼Œæ‰‹åŠ¨åªè®¾ç½® canvas å°ºå¯¸ä¼šæœ‰æ¨¡ç³Šçš„é—®é¢˜ã€‚

è¿™ä¸ªé€šè¿‡æ˜é‡‘æœç´¢äº†ä¸€ä¸‹å°±å¾—åˆ°äº† [lottieåŠ¨ç”»æ¨¡ç³Šé—®é¢˜çš„è§£å†³æ–¹æ³•](https://juejin.cn/post/7171273016762974216#heading-7)ã€‚

å¾®è°ƒä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œå°±å¯ä»¥è§£å†³æ¨¡ç³Šé—®é¢˜ã€‚

```js
const canvas = res[0].node
canvas.width = 600
canvas.height = 600

// ä¸‹é¢æ˜¯æ–°å¢çš„ä»£ç 
const dpr = wx.getSystemInfoSync().pixelRatio
canvas.width = canvas.width * dpr
canvas.height = canvas.height * dpr
context.scale(dpr, dpr)

lottie.setup(canvas)
```

### å…¨å±åŠ¨ç”»
å¼¹çª—çš„åŠ¨ç”»éœ€è¦å…¨å±å±•ç¤ºï¼Œå› æ­¤éœ€è¦è®¾ç½® `canvas` å®½é«˜ä¸ºé¡µé¢å®½é«˜ã€‚

index.wxss
```css
#lottie-canvas{
    position: fixed;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
}
```

index.jsï¼Œä½¿ç”¨ `wx.getSystemInfoSync` è·å–è®¾å¤‡çš„ä¿¡æ¯
```js
const { windowWidth, windowHeight, pixelRatio } = wx.getSystemInfoSync()
canvas.width = windowWidth * pixelRatio
canvas.height = windowHeight * pixelRatio
```
![](https://img.cdn.sugarat.top/mdImg/sugar/3dd8a0483aba8a07d9a85692197e5ce5)


### åŠ¨æ€æ–‡æ¡ˆ
ç”±äºæ˜¯çº¢åŒ…ï¼Œéœ€è¦åŠ¨æ€å±•ç¤ºé‡‘é¢ï¼ˆå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯ä¸å›ºå®šå†…å®¹çš„åŠ¨æ€æ ‡é¢˜ï¼‰ã€‚

æ€è·¯å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« [çŸ¥ä¹ï¼š åŠ¨æ€ä¿®æ”¹ Lottie ä¸­çš„æ–‡æœ¬](https://zhuanlan.zhihu.com/p/102334701?s_r=0)

å¯ä»¥ä½¿ç”¨å›ºå®šæ ¼å¼çš„æ–‡æœ¬ `${æ–‡æœ¬}` è¿›è¡Œæ›¿æ¢

```js
// ä¼ªä»£ç 
get('sourceUrl').then((res) => {
  const jsonText = res.data
  const animationData = JSON.parse(jsonText.replace('${é‡‘é¢}', 'ç›®æ ‡é‡‘é¢'))
})
```

æ¯”å¦‚æˆ‘åœ¨ demo é‡ŒåŠ ä¸€ä¸ªæ–‡å­—
* éœ€è¦å±•ç¤ºçš„æ–‡æœ¬é‡Œæ”¾å…¥ `${num}` ç”¨äºæ›¿æ¢åŒ¹é…
* åœ¨æ·»åŠ ä¸€ä¸ªæ–‡æœ¬è—åœ¨çœ‹ä¸è§çš„åœ°æ–¹,é‡Œé¢å†™å…¥æ›¿æ¢åéœ€è¦ç”¨åˆ°çš„æ–‡å­—ï¼ˆç¡®ä¿å’Œä¸Šé¢çš„æ–‡æœ¬ä¸ºåŒä¸€ç§å­—ä½“ï¼‰

![](https://cdn.upyun.sugarat.top/test/sugar/f2bd93aa21e7cd2328c987948d4557a7)

æ¥ç€å¯¼å‡º JSON æ–‡ä»¶ã€‚

è°ƒç”¨æ–¹æ³•å¦‚ä¸‹
```js
// æ‹‰å–JSONæ–‡ä»¶å†…å®¹
const jsonData = await new Promise((resolve) => {
  wx.request({
    url: 'http://127.0.0.1:8080/json/text-replace/data.json',
    success: (res) => {
      resolve(res.data)
    }
  })
})

// éšæœºç”Ÿæˆ1-100å…ƒçš„æ•°å­—ï¼Œä¿ç•™ä¸¤ä½å°æ•°
const num = (Math.random() * 100).toFixed(2)
// æ›¿æ¢å†…å®¹
const animationData = JSON.parse(
  JSON.stringify(jsonData)
    .replace(/\$\{num\}/g, `${num}å…ƒ`)
)

lottie.loadAnimation({
  // æŒ‡å®šjsonå†…å®¹
  animationData,
  // è®¾ç½®ä¾èµ–çš„å›¾ç‰‡èµ„æºä½ç½®
  assetsPath: 'http://127.0.0.1:8080/json/text-replace/images/',
  // ...çœç•¥å…¶å®ƒé…ç½®
})
```

æ•ˆæœå¦‚ä¸‹

![](https://cdn.upyun.sugarat.top/mdImg/sugar/290fee264246526131c5048c67125711)


### style å¼•å‘çš„æ¸²æŸ“é”™è¯¯

åœ¨ canvas æ ‡ç­¾ä¸Šè®¾ç½® `display`æ§åˆ¶æ˜¾éšï¼Œå¶ç°ä¼šæç¤ºæ¸²æŸ“å±‚é”™è¯¯ã€‚

```html
<canvas style="display:{{show?'block':'none'}}" id="c1" type="2d"></canvas>
```

![](https://cdn.upyun.sugarat.top/mdImg/sugar/cedddb72f45046ca974cb594be964eeb)

è§£å†³åŠæ³•ï¼Œç»™å¥—äº†ä¸€å±‚ `view`ï¼Œç”¨`wx:if`æ§åˆ¶å’¯ã€‚
```html
<view  wx:if="{{show}}">
  <canvas id="c1" type="2d"></canvas>
</view>

```

### iOS æ’­æ”¾é—ªé€€é—®é¢˜

ç°è±¡æ˜¯ï¼Œéå†·å¯åŠ¨å°ç¨‹åºçš„æ—¶å€™ï¼ŒåŠ¨ç”»è¿˜æ²¡æ’­æ”¾å®Œæ¯•å°±æå‰ç»“æŸäº†ã€‚

çœ‹ä»£ç logï¼Œ3sçš„åŠ¨ç”»ï¼Œæ’­æ”¾ä¸åˆ° 1s å°±è§¦å‘äº† `complete` äº‹ä»¶ï¼Œçœ‹ç°è±¡å°±æ˜¯ä¸€é—ªè€Œé€ã€‚

```js
const ani = lottie.loadAnimation({
  // 3s çš„åŠ¨ç”»
  animationData,
  // ...çœç•¥å…¶å®ƒé…ç½®
})

ani.addEventListener('complete', () => {
  console.log('åŠ¨ç”»æ’­æ”¾ç»“æŸ')
})
```

é—®é¢˜æ’æŸ¥ï¼š

â‘  ç¿»çœ‹æºç [lottie-miniprogram](https://github.com/wechat-miniprogram/lottie-miniprogram/tree/master)

åœ¨ `src/adapter/index.js` ä¸­çœ‹åˆ°[ä¸‹é¢è¿™æ®µä»£ç ](https://github.com/wechat-miniprogram/lottie-miniprogram/blob/49066a6479d710b5863754613a518c65487912db/src/adapter/index.js#L89-L101)

```js
window.requestAnimationFrame = function requestAnimationFrame(cb) {
  let called = false
  setTimeout(() => {
    if (called) {
      return
    }
    called = true
    typeof cb === 'function' && cb(Date.now())
  }, 100)
  canvas.requestAnimationFrame((timeStamp) => {
    if (called) {
      return
    }
    called = true
    typeof cb === 'function' && cb(timeStamp)
  })
}
```
åœ¨ç¿»çœ‹ä¸€ä¸‹å°ç¨‹åºæ–‡æ¡£é‡Œ [canvas.requestAnimationFrame](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Canvas.requestAnimationFrame.html) æ–‡æ¡£è¯´æ˜ã€‚

![](https://cdn.upyun.sugarat.top/mdImg/sugar/36b0cfb5ce7dca2c6916caf71aeff2ff)

æœ‰ç‚¹æ‚Ÿäº†ä¸Šé¢çš„ `setTimeout` ä»£ç ï¼Œåº”è¯¥æ˜¯ä¸ºäº†å…¼å®¹ä½ç‰ˆæœ¬çš„å°ç¨‹åºï¼Œé‡Œé¢è¿˜æœ‰ `called` å˜é‡æ§åˆ¶ï¼Œä¸é‡å¤æ‰§è¡Œã€‚

çŒœæµ‹å¯èƒ½æ˜¯åœ¨æ’­æ”¾çš„æ—¶å€™æ‰§è¡Œäº† `setTimeout` é‡Œçš„é€»è¾‘å¯¼è‡´åŠ¨ç”»æå‰ç»“æŸã€‚

äºæ˜¯æˆ‘å°±åŠ ä¸Šäº† `console.log` å‘å¸ƒåˆ°çº¿ä¸ŠéªŒè¯ä¸€ä¸‹ã€‚

```js
setTimeout(() => {
  if (called) {
    return
  }
  called = true
  console.log('setTimeout', Date.now()) // [!code ++]
  typeof cb === 'function' && cb(Date.now())
}, 100)

canvas.requestAnimationFrame((timeStamp) => {
  if (called) {
    return
  }
  console.log('canvas.requestAnimationFrame', timeStamp) // [!code ++]
  called = true
  typeof cb === 'function' && cb(timeStamp)
})
```

vconsole æ‰“å°ç»“æœå¦‚ä¸‹ï¼š

![](https://cdn.upyun.sugarat.top/mdImg/sugar/8ee7e4cf3535cb2e4caba929abfe205c)

*ä¸€ç‚¹è¡¥å……ï¼Œé’ˆå¯¹ `canvas.requestAnimationFrame` å›åˆ°å‡½æ•°çš„å…¥å‚ï¼Œå°ç¨‹åºæ–‡æ¡£é‡Œè™½æ²¡æœ‰è¯¦ç»†ä»‹ç»ï¼Œä½†å¯ä»¥å¯¹æ ‡ Web çš„
 [Windowï¼šrequestAnimationFrame() æ–¹æ³•](https://developer.mozilla.org/zh-CN/docs/Web/API/window/requestAnimationFrame) çœ‹ä¸€ä¸‹ MDN ä¸Šçš„è§£é‡Šã€‚*

![](https://cdn.upyun.sugarat.top/mdImg/sugar/2d307758e0873a89aa4fb33602547ed7)

ä»ä¸Šé¢çš„ `console` æ—¥å¿—çœ‹ï¼ŒåŸå› ç¡®å®æ˜¯æ‰§è¡Œ setTimeout é‡Œé¢çš„é€»è¾‘å¯¼è‡´çš„åŠ¨ç”»ç»“æŸã€‚

å¯ä»¥å¾—åˆ°å¼•å‘bugçš„åŸå› ï¼šâ†“

**æŸç§æƒ…å†µä¸‹ï¼Œ`setTimeout(callback, 100)` æ¯” `canvas.requestAnimationFrame` æ›´å¿«æ‰§è¡Œã€‚**

*è¿™ä¸ªåº“å¾ˆä¹…æ²¡è¿­ä»£äº†ï¼ˆç°æœ‰ç‰ˆæœ¬æ˜¯3å¹´å‰å‘å¸ƒçš„ï¼‰ï¼Œæ¯å‘¨è¿˜æ˜¯æœ‰ä¸€äº›ä¸‹è½½é‡ï¼Œissue é‡Œä¹Ÿæ²¡æœ‰æåˆ° iOS æœ‰è¿™ä¸ªé—®é¢˜ï¼ï¼ˆåˆ‡æ¢æ¸²æŸ“æ¨¡å¼ä¸º skyline ä¹Ÿæ²¡æœ‰è§¦å‘è¿™ä¸ªé—®é¢˜ï¼Œé—®é¢˜åªåœ¨ webview æ¨¡å¼ä¸‹æœ‰ï¼Œä¸”ä»…ä½¿ç”¨ç®€å•Demoä¹Ÿæ— æ³•å¤ç°è¿™ä¸ªé—®é¢˜ï¼‰*

*ä¹Ÿä¸æ¸…æ¥šå°ç¨‹åºé‡Œ canvas.requestAnimationFrame å®ç°æœºåˆ¶ã€‚*

![](https://cdn.upyun.sugarat.top/mdImg/sugar/5c5a97df02d19c6b7248b1c983b5a639)

å¤§èƒ†æ£æµ‹ä¸€ä¸‹åŸå› ï¼š

**é¡µé¢å®ç°å¯èƒ½è¿‡äºå¤æ‚ï¼Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‰§è¡Œé˜»å¡åœ¨é€»è¾‘å±‚ï¼Œå¯¼è‡´ setTimeout æ—¶é—´åˆ°äº†ä»¥åå›è°ƒå‡½æ•°å…¥æ ˆï¼Œæ¥ç€å°±åœ¨é€»è¾‘å±‚è°ƒç”¨æ‰§è¡Œäº†**

è§£å†³åŠæ³•ï¼š

![](https://cdn.upyun.sugarat.top/mdImg/sugar/182858ba4f246bf28417cda3fb029b8f)

**æ—¢ç„¶æ˜¯å…¼å®¹å®ç°ï¼Œå°±åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å­˜åœ¨ `requestAnimationFrame` æ–¹æ³•ï¼Œå­˜åœ¨å°±ä¸æ‰§è¡Œ `setTimeout` ç›¸å…³é€»è¾‘ã€‚**

å®Œæ•´è§£å†³ PR è§ï¼šhttps://github.com/wechat-miniprogram/lottie-miniprogram/pull/50

å°†æ‰“åŒ…åçš„äº§ç‰©æ›¿æ¢åˆ° `node_modules` é‡Œå¯¹åº”ä½ç½®åï¼Œå†ä½¿ç”¨ [patch-package](https://www.npmjs.com/package/patch-package) ç”Ÿæˆ patchï¼Œä»¥ä¾¿åç»­å®‰è£…ä¾èµ–è‡ªåŠ¨æ›´æ–°

## æœ€å
æ—¶é—´åŒ†å¿™ï¼Œä»‹ç»çš„ä¸æ˜¯éå¸¸çš„è¯¦ç»†ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è¯„è®ºåŒºäº¤æµã€‚

`demo` å®Œæ•´æºç è§ [GitHubï¼šlottie-demo](https://github.com/ATQQ/demos/tree/main/miniprogram/lottie-demo)

![](https://img.cdn.sugarat.top/mdImg/sugar/c5a59914529f4b50a969ec7f1caadc36)
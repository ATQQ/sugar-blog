---
title: é©¬ä¸Šä¸­ç§‹äº†ï¼ŒæŠŠé¼ æ ‡æŒ‡é’ˆå˜ä¸ºå°ç‰å…”
date: 2021-09-11
tags:
 - æŠ€æœ¯ç¬”è®°
 - æŠ€æœ¯æ•™ç¨‹
categories:
 - æŠ€æœ¯ç¬”è®°
---
# é©¬ä¸Šä¸­ç§‹äº†ï¼ŒæŠŠé¼ æ ‡æŒ‡é’ˆå˜ä¸ºå°ç‰å…”

>æˆ‘æ­£åœ¨å‚åŠ ä¸­ç§‹åˆ›æ„æŠ•ç¨¿å¤§èµ›ï¼Œè¯¦æƒ…è¯·çœ‹ï¼š[ä¸­ç§‹åˆ›æ„æŠ•ç¨¿å¤§èµ›](https://juejin.cn/post/7003154195826081800)â€

## å‰è¨€
é©¬ä¸Šä¸­ç§‹èŠ‚å•¦ï¼Œæ˜é‡‘åˆå¼€å§‹[æ•´æ´»](https://juejin.cn/post/7003154195826081800)äº†ï¼Œæ°å·§æœ€è¿‘å‡†å¤‡åšçš„å·¥å…·ä¼šæ¶‰åŠåˆ°é¼ æ ‡æŒ‡é’ˆçš„å˜åŠ¨ï¼Œå°±é¡ºæ‰‹å…ˆå†™ä¸ªdemoè¹­è¹­æ´»åŠ¨äº†ã€‚

é¡ºä¾¿æå‰ç¥å¤§å®¶ğŸ‘ä¸­ç§‹èŠ‚å¿«ä¹ã€‚

å½“ç„¶è¿™ä¸ªé¼ æ ‡æŒ‡é’ˆçš„å˜åŠ¨åªåœ¨Webåº”ç”¨ä¸­ç”Ÿæ•ˆ

æ–¹ä¾¿çš„è¯å¯ä»¥[åŸæ–‡](https://juejin.cn/post/7006592666846625823)æˆ³ä¸ªèµ
## æ•ˆæœå¦‚ä¸‹
![å›¾ç‰‡](https://img.cdn.sugarat.top/mdImg/MTYzMTM0MDYwODYyOQ==631340608629)

emmmmm...åŠ¨å›¾æ—¶é—´è¾ƒé•¿ï¼Œéœ€è¦ç­‰ä¸€ä¼šå„¿æ•ˆæœæ‰å‡ºæ¥

## ç ä¸Šä½“éªŒ
åœ¨devtoolsä¸­è¿è¡Œä¸‹é¢è¿™æ®µç¥ç§˜ä»£ç å³å¯ï¼Œå®ç°æºç è§[æ­¤å¤„](https://github.com/ATQQ/demos/blob/main/yuebingCursor/index.js)
```js
const script = document.createElement('script')
script.src = 'https://img.cdn.sugarat.top/demo/js-sdk/zq-rabbit/0.0.2/index.js'
document.body.append(script)
```
å°†æ­¤éƒ¨åˆ†ä»£ç åŠ å…¥åˆ°ç›®æ ‡é¡µé¢ä¸­å³å¯
## å®ç°æ€è·¯
ä»åŠ¨å›¾ä¸­çœ‹åˆ°å…±æœ‰ä¸¤ç§å…ƒç´ ï¼š
1. é¼ æ ‡ç§»åŠ¨æ—¶ï¼Œé¼ æ ‡è¢«æ›¿æ¢æˆäº†ç‰å…”
2. ç‰å…”çš„å°¾å·´å¤„è·Ÿç€ä¸€ä¸²æœˆé¥¼ğŸ¥®

ä¸‹é¢é€šè¿‡QAçš„æ–¹å¼ï¼Œå°†å¼€å‘ä¸­æ¶‰åŠåˆ°çš„é—®é¢˜å…ˆè¿‡ä¸€ä¸‹ã€‚

### è·å¾—é¼ æ ‡æŒ‡é’ˆçš„ä½ç½®

é€šè¿‡ç›‘å¬`window`ä¸Šçš„`mousemove`äº‹ä»¶ï¼Œå³å¯è·å–åˆ°é¼ æ ‡ç§»åŠ¨æ—¶çš„ä½ç½®å‚æ•°

### éšè—åŸæ¥çš„æŒ‡é’ˆ

cssæœ‰ä¸€ä¸ªå±æ€§[cursor](https://developer.mozilla.org/zh-CN/docs/Web/CSS/cursor)å¯ä»¥ç”¨äºè®¾ç½®æŒ‡é’ˆçš„ç±»å‹ã€‚æˆ‘ä»¬å°†æ•è·äº‹ä»¶çš„dom(event.target)çš„cursorè®¾ç½®ä¸º`none`å³å¯

### å®ç°æŒ‡é’ˆçš„å˜æ›´

è§£å†³äº†ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„`dom`å…ƒç´ æ¥æ›¿ä»£æˆ‘ä»¬çš„æŒ‡é’ˆï¼Œé€šè¿‡å®æ—¶è·å–åˆ°é¼ æ ‡çš„ä½ç½®ï¼Œå®æ—¶æ›´æ–°æˆ‘ä»¬çš„domå…ƒç´ ä½ç½®å³å¯

### å®ç°é¼ æ ‡è½¨è¿¹
æ¯ä¸ªä¸€æ®µæ—¶é—´ï¼ˆå¦‚30msï¼‰è®°å½•ä¸€ä¸‹é¼ æ ‡çš„ä½ç½®ï¼Œç„¶åä¸ç»˜åˆ¶æŒ‡é’ˆä¸€æ ·çš„é€»è¾‘ï¼Œå°†è½¨è¿¹ç”¨æœˆé¥¼ğŸ¥®ç»˜åˆ¶å‡ºæ¥


è¿™é‡Œåªæè¿°äº†å¼€å‘ä¸­åˆæœŸä¼šé‡åˆ°çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€äº›å…¶å®ƒé—®é¢˜å°†åœ¨ä¸‹é¢è¯¦ç»†å®ç°éƒ¨åˆ†è¿›è¡Œä»‹ç»

## ç‰å…”æŒ‡é’ˆå®ç°
ç›‘å¬`mousemove`äº‹ä»¶ï¼Œè·å–æŒ‡é’ˆç›¸å¯¹å±å¹•é¡¶éƒ¨ä¸å·¦ä¾§ä½ç½®ä¿¡æ¯
```js
window.addEventListener('mousemove', function (e) {
    const { clientX, clientY } = e
})
```

åˆ›å»ºä¸€ä¸ªå…ƒç´ ï¼Œè®¾ç½®å…¶èƒŒæ™¯å›¾ä¸ºç‰å…”ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°ä¸»æ–‡æ¡£ä¸­ï¼Œå¹¶åˆå§‹åŒ–ä¸€äº›ä½ç½®/å½¢çŠ¶ç›¸å…³çš„csså±æ€§ã€‚
```js
const size = '30px'
function createCursor() {
    const cursor = h()
    cursor.id = 'cursor'

    addStyles(cursor, `
    #cursor{
        background-image:url(https://img.cdn.sugarat.top/mdImg/MTYzMTMyNDYwNTgzMQ==631324605831);
        width:${size};
        height:${size};
        background-size:${size} ${size};
        position:fixed;
        display:none;
        cursor:none;
        transform: translate(-30%, -20%);
    }
    `)
    document.body.append(cursor)
    return cursor
}
const cursor = createCursor()

// å·¥å…·æ–¹æ³•
function addStyles(target, styles) {
    const style = document.createElement('style')
    style.textContent = styles
    target.append(style)
}

function h(tag = 'div') {
    return document.createElement(tag)
}
```

ç¼–å†™æ›´æ–°ç‰å…”ä½ç½®çš„æ–¹æ³•`refreshCursorPos`ï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´åï¼Œè®©æŒ‡é’ˆæ¢å¤åŸçŠ¶
```js
function refreshCursorPos(x, y) {
    cursor.style.display = 'block'
    cursor.style.cursor = 'none'
    cursor.style.left = `${x}px`
    cursor.style.top = `${y}px`

    // ä¸€æ®µæ—¶é—´åéšè—
    if (refreshCursorPos.timer) {
        clearTimeout(refreshCursorPos.timer)
    }
    refreshCursorPos.timer = setTimeout(() => {
        cursor.style.display = 'none'
    }, 500)
}
```

ä¸æ­¤å‰çš„æ–¹æ³•ç»“åˆï¼Œå¹¶å°†ç›®æ ‡å…ƒç´ çš„æŒ‡é’ˆéšè—ä¸€æ®µæ—¶é—´ï¼Œéšè—ä¸æ¢å¤è¿™é‡Œç”¨`WeakMap`æ¥åšä¸€ä¸ªè¾…åŠ©ï¼Œå­˜å‚¨èŠ‚ç‚¹ä¸å®šæ—¶å™¨çš„æ˜ å°„å…³ç³»ï¼Œåšä¸ªç®€å•çš„é˜²æŠ–

```js
const weakMap = new WeakMap()
window.addEventListener('mousemove', function (e) {
    const { clientX, clientY } = e

    // éšè—æ•è·mousemoveäº‹ä»¶çš„å…ƒç´ çš„æŒ‡é’ˆï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´åæ¢å¤
    e.target.style.cursor = 'none'
    let timer = weakMap.get(e.target)
    if(timer){
        clearTimeout(timer)
    }
    timer = setTimeout(()=>{
        e.target.style.cursor = 'auto'
    },500)
    weakMap.set(e.target,timer)
    
    // æ›´æ–°ç‰å…”ä½ç½®
    refreshCursorPos(clientX, clientY)
})
```

åˆ°è¿™é‡Œä½ ä»¥ä¸ºå°±ç»“æŸäº†ï¼Ÿå½“ç„¶æ²¡æœ‰ï¼Œæ­¤æ—¶ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä½ çš„ç‰å…”æŒ‡é’ˆæ— æ³•æ­£å¸¸å·¥ä½œï¼Œå¦‚ä¸‹æ‰€ç¤º

![å›¾ç‰‡](https://img.cdn.sugarat.top/mdImg/MTYzMTM0NDc3ODMwMQ==631344778301)

å½“æœˆå…”å‡ºç°çš„æ—¶å€™ï¼Œæ— æ³•æ­£å¸¸ç‚¹å‡»è·³é“¾ï¼Œé€‰æ‹©æ–‡å­—å…ƒç´ 

åŸå› æ˜¯ç”±äºï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½è¢«ä½ çš„"æœˆå…”"æ‰€æ•è·äº†

å¦‚ä½•é¿å…äº‹ä»¶è¢«ç›®æ ‡å…ƒç´ æ•è·ï¼Ÿ é€šè¿‡cssè®¾ç½®å…ƒç´ [pointer-events](https://developer.mozilla.org/zh-CN/docs/Web/CSS/pointer-events)å±æ€§ä¸º`none`å³å¯ï¼Œè®¾ç½®ä¸º`none`åï¼Œç›®æ ‡å…ƒç´ æ°¸è¿œä¸ä¼šæˆä¸ºé¼ æ ‡äº‹ä»¶çš„`target`

äºæ˜¯ä¸º`#cursor`å…ƒç´ çš„cssï¼Œæ·»ä¸Šä¸€è¡Œæ ·å¼`pointer-events: none;`å³å¯

## æœˆé¥¼è½¨è¿¹å®ç°

æœ‰äº†ä¸Šé¢å®ç°ç‰å…”æŒ‡é’ˆçš„ç»éªŒå®ç°æœˆé¥¼è½¨è¿¹å°±å¾ˆå®¹æ˜“äº†

æ¯ä¸ªæœˆé¥¼å…ƒç´ å‡ç”¨ä¸€ä¸ªdivç»˜åˆ¶ï¼Œå°†æœˆé¥¼çš„åˆå§‹æ ·å¼è¡¨å…ˆåŠ å…¥åˆ°é¡µé¢ä¸­
```js
const orbitSize = '40px'
addStyles(document.body, `
    .orbit{
        background-image:url(https://img.cdn.sugarat.top/mdImg/MTYzMTMyNDMwODg2Nw==631324308867);
        width:${orbitSize};
        height:${orbitSize};
        background-size:${orbitSize} ${orbitSize};
        position:fixed;
        display:none;
        cursor:none;
        pointer-events: none;
    }
`)
```

æœˆé¥¼è½¨è¿¹ä¸Šé™çš„æœˆé¥¼è®¾ç½®ä¸º**5**ä¸ªï¼Œç®€å•çš„å¾ªç¯åˆ›å»ºä¸€ä¸‹
```js
const ybCounts = 5
const domList = []
for (let i = 0; i < ybCounts; i++) {
    const d = h()
    d.classList.add('orbit')
    domList.push(d)
    document.body.append(d)
}
```

åˆ›å»ºä¸€ä¸ªæ•°ç»„ç”¨äºå­˜å‚¨æŒ‡é’ˆæœ€è¿‘çš„**5**ä¸ªä½ç½®ï¼Œä¸€ä¸ªä¸´æ—¶å˜é‡ç”¨äºåç»­è¾…åŠ©å­˜å‚¨è½¨è¿¹ç‚¹ä¿¡æ¯
```js
const posList = []
let now = 0
```

ç¼–å†™`refreshOrbit`æ–¹æ³•ç”¨äºæ›´æ–°è½¨è¿¹ï¼š
* ç”±äºè½¨è¿¹æœ‰ä¸ªç¼©æ”¾çš„æ•ˆæœï¼Œè¶Šåˆ°åé¢çš„åœ†é¥¼è¶Šå°ï¼Œè¿™é‡Œé€šè¿‡`maxScale`ç¡®å®šæœ€å¤§çš„æ”¾å¤§å€æ•°
* æ ¹æ®è½¨è¿¹ç‚¹ä¸ªæ•°ï¼Œç¡®å®šæ¯ä¸ª`æœˆé¥¼`æœ€ç»ˆçš„ç¼©æ”¾å€æ•°
* æ ¹æ®å­˜å‚¨çš„æŒ‡é’ˆä½ç½®ä¿¡æ¯ï¼Œä¸€ä¸€å¯¹åº”çš„æ›´æ–°æœˆé¥¼ä½ç½®å³å¯
```js
function refreshOrbit(x, y) {
    // åˆ·æ–°ä½ç½®
    const maxScale = 1.5
    const minScale = maxScale / domList.length
    posList.forEach(({ x, y }, idx) => {
        const dom = domList[idx]
        dom.style.display = 'block'
        dom.style.left = `${x}px`
        dom.style.top = `${y}px`
        dom.style.transform = `scale(${(idx + 1) * minScale}) translate(10%,10%)`
        if (dom.timer) {
            clearTimeout(dom.timer)
        }
        dom.timer = setTimeout(() => {
            dom.style.display = 'none'
        }, 50 * (idx + 1))
    })

    const nowTime = Date.now()
    // éš”ä¸€æ®µæ—¶é—´å­˜å‚¨ä¸€ä¸ª
    if (now + 50 > nowTime) {
        return
    }
    now = nowTime
    posList.push({
        x, y
    })
    // åªå­˜å‚¨é™å®šçš„ä¸ªæ•°
    if (posList.length === ybCounts+1) {
        posList.shift()
    }
}
```

æ—¶é—´å›æ‰ä¸­è°ƒç”¨æ›´æ–°è½¨è¿¹çš„æ–¹æ³•
```js
window.addEventListener('mousemove', function (e) {
    const { clientX, clientY } = e
    // ...çœç•¥å…¶å®ƒä»£ç 
    // æ›´æ–°æœˆé¥¼è½¨è¿¹
    refreshOrbit(clientX, clientY)
})
```

## æ”¯æŒç§»åŠ¨ç«¯
è¿™ä¸ªç®€å•ï¼Œç›‘å¬`touchmove`äº‹ä»¶å³å¯
```js
window.addEventListener('touchmove', function (e) {
    const { clientX, clientY } = e.changedTouches[0]
    refreshCursorPos(clientX, clientY)
    
    // æ›´æ–°æœˆé¥¼è½¨è¿¹
    refreshOrbit(clientX, clientY)
})
```

## æœ€å
åç»­å‡†å¤‡æŠŠè¿™ä¸ªè®¾ç½®æŒ‡é’ˆæ ·å¼çš„è„šæœ¬æŠ½æˆä¸€ä¸ªé€šç”¨çš„js sdkå’Œå¤§å®¶åˆ†äº«ï¼Œè¿™æ ·æƒ³æ€ä¹ˆæ”¹æŒ‡é’ˆæ ·å¼å°±æ€ä¹ˆæ”¹

å¤§å®¶æœ‰æ›´å¥½çš„æ–¹æ¡ˆå¯ä»¥è¯„è®ºåŒºäº¤æµä¸€æ³¢


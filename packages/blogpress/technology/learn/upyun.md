---
description: åˆ†äº«ä¸€ä¸‹åˆæ‹äº‘çš„ç®€å•ç”¨æ³•ï¼Œä»¥åŠä½¿ç”¨å®ƒæ­å»ºå›¾åºŠã€‚
---
# ä½¿ç”¨åˆæ‹äº‘æé€Ÿæ­å»ºå›¾åºŠ

## å‰è¨€

æŸå¤©åœ¨ç¾¤é‡Œæ‘¸ ğŸŸ ï¼ŒèŠåˆ°äº†å›¾åºŠç›¸å…³çš„è¯é¢˜ï¼Œç¾¤å‹æ¨èäº† [åˆæ‹äº‘](https://www.upyun.com/league)ã€‚

è¯´æœ‰æ´»åŠ¨ï¼Œå¯ä»¥ç™½å«–å­˜å‚¨ï¼Œ`10G + 15Gï¼ˆHTTP/HTTPS æµé‡ï¼‰` ã€‚ç¬”è€…ä¹‹å‰ä¸€ç›´ç”¨çš„[ä¸ƒç‰›äº‘](https://www.qiniu.com/prices/kodo) `10G + 10Gï¼ˆå›æºæµé‡ï¼‰`ã€‚

|                                    åˆæ‹äº‘                                     |                                    ä¸ƒç‰›äº‘                                     |
| :---------------------------------------------------------------------------: | :---------------------------------------------------------------------------: |
| ![](https://img.cdn.sugarat.top/mdImg/sugar/96868081e49914aa6ab7ee142e064d56) | ![](https://img.cdn.sugarat.top/mdImg/sugar/4a1fb149f7dbcfa43af08f1354781d76) |
|                   æ³¨å†Œé€1ä¸ªæœˆçš„ä»£é‡‘åˆ¸ + ç½‘ç«™æŒ‚æ¨å¹¿é€1å¹´ä»£é‡‘åˆ¸                   |                              æ³¨å†Œå³å¯é€æ¯æœˆéƒ½æœ‰                               |

ç¬”è€…å°±èŠ±äº†ç‚¹æ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹åˆæ‹äº‘çš„ SDK å’Œå¯¹è±¡å­˜å‚¨ï¼Œèƒ½åŠ›ä¸Šå®Œå…¨å¯ä»¥å¹³æ›¿ä¸ƒç‰›äº‘ï¼Œäºæ˜¯å°±èŠ±äº†ä¸€ç‚¹æ—¶é—´ç»™[å›¾åºŠåº”ç”¨](https://imgbed.sugarat.top/)åŠ ä¸Šäº†åˆæ‹äº‘çš„æ”¯æŒã€‚

## æ•ˆæœ

å¤§å®¶å¯ä»¥è®¿é—® https://imgbed.sugarat.top/ ç›´æ¥ä½“éªŒï¼Œé»˜è®¤å·²é…ç½® åˆæ‹äº‘ å­˜å‚¨

ä¸‹é¢å°†ä»‹ç» åˆæ‹äº‘å¯¹è±¡å­˜å‚¨é…ç½®ï¼Œå…³é”®APIç”¨æ³•ï¼Œå¦‚ä½•æ¥å…¥ä¸Šè¿°å›¾åºŠã€‚

## å¯¹è±¡å­˜å‚¨æœåŠ¡åˆ›å»º 
è¿™é‡Œç›´æ¥çœç•¥è´¦å·æ³¨å†Œï¼Œå‚åŠ æ¨å¹¿æ´»åŠ¨ç­‰æ­¥éª¤ï¼Œç›´æ¥è¿›å…¥å¯¹è±¡å­˜å‚¨é…ç½®é¡µé¢ã€‚

è®¿é—®[å¯¹è±¡å­˜å‚¨æ§åˆ¶å°](https://console.upyun.com/services/file/)ï¼Œç‚¹å‡»åˆ›å»ºæœåŠ¡

![](https://img.cdn.sugarat.top/mdImg/sugar/5c0388757ee62813255ea400b0a9907b)

è¿™ä¸ª"æœåŠ¡"å’Œå…¶å®ƒå¹³å°çš„ `Bucket(æ¡¶)` ç±»ä¼¼ï¼Œå¯ä»¥ç†è§£ä¸ºå­˜å‚¨ç©ºé—´çš„æ¦‚å¿µã€‚

å¡«ä¸€ä¸‹æœåŠ¡åç§°ï¼ˆ`å…¨å¹³å°å”¯ä¸€`ï¼‰ï¼Œç»‘å®šè´¦å·å³å¯

![](https://img.cdn.sugarat.top/mdImg/sugar/8358d7845041f2cfa1e9af3751eca150)

**æœåŠ¡åˆ›å»ºå®Œï¼Œéœ€è¦çš„ä¸œè¥¿åŸºæœ¬éƒ½æœ‰äº†ï¼Œæ˜¯ä¸æ˜¯éå¸¸ç®€å•ï¼**

* æœåŠ¡åï¼šè‡ªå®šä¹‰
* è´¦å·ï¼šè‡ªå®šä¹‰
* å¯†ç ï¼šè‡ªåŠ¨ç”Ÿæˆ
* åŸŸåï¼šæµ‹è¯•åŸŸå `serviceName.test.upcdn.net`


## API ä½¿ç”¨
### token ç”Ÿæˆ
è¿™é‡Œæ¨èä½¿ç”¨ token è®¤è¯ æ ¹æ®[æ–‡æ¡£ï¼šè®¤è¯é‰´æƒ](https://help.upyun.com/knowledge-base/object_storage_authorization/#token-e8aea4e8af81)å¯çŸ¥ç”Ÿæˆæ–¹å¼å¦‚ä¸‹ï¼š

![](https://img.cdn.sugarat.top/mdImg/sugar/9018f184d07b38b69f53f7335aa7cd2e)

çœ‹ä¸æ‡‚ï¼Ÿæ²¡å…³ç³» GPT å¯ä»¥å¸®ä½ ï¼Œç›´æ¥å¤åˆ¶ä¸¢ç»™å®ƒã€‚

![](https://img.cdn.sugarat.top/mdImg/sugar/16cb9a0c8e480e61304a2366d3568878)

è¿™ä¸ä»£ç å°±æ¥äº†ã€‚

æˆ‘ä»¬å¯ä»¥é€‚å½“ä¼˜åŒ–ä¸€ä¸‹ï¼Œä¸éœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“`base64-js`ï¼Œç›´æ¥ä½¿ç”¨ Node.js çš„å†…ç½®æ¨¡å—`crypto` å³å¯ã€‚
```js
import crypto from 'crypto'

/**
 * ç”Ÿæˆ upyun ä¸Šä¼ token
 * @param {*} operator è´¦å·
 * @param {*} password å¯†ç 
 * @param {*} method æ–¹æ³•ï¼ˆPUTï¼‰
 * @param {*} uriPrefix è¯·æ±‚å…¬å…±å‰ç¼€
 * @param {*} date è¿‡æœŸæ—¶é—´
 * @returns ä¸Šä¼ å‡­è¯
 */
function generateUpyunToken(operator, password, method, uriPrefix, date) {
  // å¯†ç çš„md5å€¼ï¼Œç§˜é’¥
  const secret = crypto.createHash('md5').update(password).digest('hex')

  // æ„é€ ç”¨äºè®¡ç®—æ ¡éªŒå€¼çš„å­—ç¬¦ä¸²
  const value = `${method}&${uriPrefix}&${date}`

  // ä½¿ç”¨ hmac-sha1 ç®—æ³•ç”Ÿæˆtoken
  const token = crypto.createHmac('sha1', secret) // ä½¿ç”¨å¯†ç çš„MD5å€¼ä½œä¸ºç§˜é’¥
    .update(value) // è®¾ç½®ç”¨äºè®¡ç®—æ ¡éªŒå€¼çš„å­—ç¬¦ä¸²
    .digest() // è®¡ç®—æ ¡éªŒå€¼
    .toString('base64') // è½¬æ¢ä¸ºbase64 æ ¼å¼

  // ç»„åˆæˆè¦æ±‚çš„æ ¼å¼
  return `UPYUN ${operator}:${token}`
}
```
ä»£ç éå¸¸ç®€æ´æ˜äº†ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹
```js
const token = generateUpyunToken('è´¦å·',
  'å¯†ç ',
  'PUT',
  'æœåŠ¡å/èµ„æºå…¬å…±å‰ç¼€è·¯å¾„', // æœåŠ¡å + å…¬å…±èµ„æºå‰ç¼€è·¯å¾„æ„æˆ
  new Date().getTime() + 1000 * 60 * 60 * 24 * 90 // è®¡ç®—è¿‡æœŸæ—¶é—´ 90å¤©åçš„æ—¥æœŸ
)
```

ç†è®ºä¸Šè¿™ä¸ª token ä¹Ÿå¯ä»¥åœ¨å‰ç«¯ç”Ÿæˆï¼Œè°ƒç”¨å’Œåç«¯ä¸€è‡´çš„ç®—æ³•å³å¯ã€‚

### å‰ç«¯ä¸Šä¼ 
â‘  å®‰è£… upyun sdk

```sh
npm i upyun
```

â‘¡ ä¸Šä¼ ç¤ºä¾‹

æ ¹æ®æ–‡æ¡£ï¼Œå¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯ä¸Šä¼ éœ€è¦çš„å‚æ•°ã€‚

![](https://img.cdn.sugarat.top/mdImg/sugar/3c68a4e45d6be0789636eefc9e8fcbbd)

* `Authorization`ï¼šå‰é¢é€šè¿‡ç”Ÿæˆçš„token
* `X-Date`ï¼šè¯·æ±‚æ—¥æœŸæ—¶é—´ï¼ŒGMT æ ¼å¼å­—ç¬¦ä¸²
* `X-Upyun-Uri-Prefix`ï¼šæœåŠ¡å + èµ„æºå…¬å…±å‰ç¼€è·¯å¾„
* `X-Upyun-Expire`ï¼šè¿‡æœŸæ—¶é—´

ä¸‹é¢å°±æ˜¯æ ¸å¿ƒçš„ä¸Šä¼ æ–¹æ³•ã€‚
```ts
import upyun from 'upyun'

const service = new upyun.Service('æœåŠ¡å')
const client = new upyun.Client(service, () => ({
  'Authorization': 'å‰é¢é€šè¿‡ç”Ÿæˆçš„token',
  'X-Date': new Date().toUTCString(),
  'X-Upyun-Uri-Prefix': 'æœåŠ¡å/èµ„æºå…¬å…±å‰ç¼€è·¯å¾„',
  'X-Upyun-Expire': date, // å‰é¢ç”Ÿæˆ Token æ—¶çš„ date å‚æ•°
}))

const sourceKey = 'èµ„æºå…¬å…±å‰ç¼€è·¯å¾„/èµ„æºå' // 'test/imgs/abc.png'

// è°ƒç”¨ä¸Šä¼ 
client.putFile(sourceKey, file) // è¿”å›å€¼ Promise<boolean>
```

â‘¢ æ–¹æ³•å°è£…

æˆ‘ä»¬å¯ä»¥ç®€å•å°è£…ä¸€ä¸‹ï¼Œæ–¹ä¾¿è°ƒç”¨
```ts
interface UPYunConfig {
  /**
   * æœåŠ¡å
   */
  serviceName: string
  /**
   * ä¸Šä¼ å‡­è¯
   */
  token: string
  /**
   * èµ„æºå…¬å…±å‰ç¼€
   */
  prefix: string
  /**
   * è¿‡æœŸæ—¶é—´ new Date().getTime() + 1000 * 60 * 60 * 24 * 90
   */
  date: number
  /**
   * åŸŸåï¼ˆç”¨äºæ‹¼æ¥æœ€åçš„è®¿é—®é“¾æ¥ï¼‰
   */
  domain: string
  /**
   * æœ€åçš„èµ„æºåï¼Œå»ºè®®ä½¿ç”¨ uuid æˆ–è€…æ–‡ä»¶çš„ MD5
   */
  filename?: string
}
async function uploadFile(file: File, ops: UPYunConfig) {
  const { serviceName, prefix, token, date, domain, filename } = ops

  const service = new upyun.Service(serviceName)
  const client = new upyun.Client(service, () => ({
    'Authorization': token,
    'X-Date': new Date().toUTCString(),
    'X-Upyun-Uri-Prefix': `${serviceName}/${prefix}`,
    'X-Upyun-Expire': date,
  }))

  const key = `${prefix}/${filename || file.name}`

  const isSuccess = await client.putFile(key, file)
  // è¿”å›æœ€åå¯ä»¥ç”¨äºè®¿é—®çš„é“¾æ¥
  return isSuccess ? Promise.resolve(`${domain}/${key}`) : Promise.reject(new Error('ä¸Šä¼ å¤±è´¥'))
}
```

## æ¥å…¥çº¯é™æ€å›¾åºŠ

ä¸Šè¿°é€»è¾‘æˆ‘éƒ½å°è£…åœ¨äº†è‡ªå·±çš„å›¾åºŠåº”ç”¨ä¸­ï¼š[GitHub: image-bed-qiniu](https://github.com/ATQQ/image-bed-qiniu/tree/master/packages/client#-%E5%9F%BA%E4%BA%8E-oss%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E5%BA%93-%E5%9B%BE%E5%BA%8A-)

åªéœ€è¦åœ¨ [cli](https://github.com/ATQQ/image-bed-qiniu/tree/master/packages/cli) ç›®å½•ä¸‹ï¼Œä¿®æ”¹ [.env](https://github.com/ATQQ/image-bed-qiniu/blob/master/packages/cli/.env) é…ç½®æ–‡ä»¶

```sh
# åˆæ‹äº‘ç›¸å…³é…ç½®
UPYUN_OPERATOR=operator
UPYUN_PASSWORD=password
UPYUN_BUCKET=service-name
UPYUN_DOMAIN=http://service-name.test.upcdn.net
UPYUN_PREFIX=image
UPYUN_SCOPE=default
# tokenæœ‰æ•ˆæœŸï¼Œé»˜è®¤3ä¸ªæœˆï¼Œå•ä½ç§’ï¼Œä½ å¯ä»¥è‡ªè¡Œè®¾ç½®ï¼ˆ60*60*24*30ï¼‰
# UPYUN_EXPIRES=2592000
```

æ‰§è¡Œ `node upyun-token.js` å³å¯ç”Ÿæˆéœ€è¦çš„ tokenã€‚

å°†å…¶ç²˜è´´é…ç½®åˆ° [çº¿ä¸Šçš„å›¾åºŠåº”ç”¨](https://imgbed.sugarat.top/)ï¼Œæˆ–è€…è‡ªå·±éƒ¨ç½²çš„å‡å¯ [image-bed-qiniu:client](https://github.com/ATQQ/image-bed-qiniu/tree/master/packages/client#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE)

![](https://img.cdn.sugarat.top/mdImg/sugar/9b11917ab2a09e1bec11e8272f0f4f2c)

## å…¶å®ƒ
çº¿ä¸Šä½¿ç”¨ï¼Œæ¨è ç»‘å®šè‡ªå®šä¹‰åŸŸå å’Œ å¼€å¯HTTPS æ”¯æŒã€‚

è¿™ä¸¤ä¸ªç›´æ¥åœ¨å¹³å°é‡Œæ ¹æ®æŒ‡å¼•æ“ä½œå³å¯ï¼Œæ­¥éª¤ä¹Ÿå¾ˆç®€å•ã€‚

## æœ€å
åç»­å‡†å¤‡æä¾›ä¸€ä¸ªå›¾åºŠçš„ Docker é•œåƒï¼Œè¿™æ ·éƒ¨ç½²èµ·æ¥ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚

å¤§å®¶æœ‰å…¶å®ƒå¯ç™½å«–çš„å›¾åºŠä¹Ÿå¯æ¨èæ¨èä¸€ä¸‹ã€‚